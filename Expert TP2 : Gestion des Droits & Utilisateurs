# R√©sum√© Expert TP2 : Gestion des Droits & Utilisateurs

Ce r√©sum√© se concentre sur les concepts de gestion des utilisateurs, des groupes, des privil√®ges et des droits sur les fichiers, en vue de votre QCM.

---

## üë• 1. Gestion des Utilisateurs et Groupes

* **Cr√©ation d'utilisateur :**
    * [cite_start]`adduser` : Outil convivial et interactif qui cr√©e l'utilisateur, son r√©pertoire personnel (`/home/login`), et demande un mot de passe[cite: 474].
    * [cite_start]`useradd` : Outil de bas niveau, non interactif (souvent utilis√© dans les scripts)[cite: 474].
* **Commandes de groupes :**
    * [cite_start]`addgroup` (ou `groupadd`) : Cr√©e un nouveau groupe[cite: 486].
    * `usermod -aG <groupe> <utilisateur>` : Ajoute un utilisateur √† un groupe. L'option `-a` (append) est cruciale pour ne pas √©craser les groupes existants.
    * [cite_start]`groups <utilisateur>` : Liste les groupes auxquels un utilisateur appartient[cite: 488].

---

## üõ°Ô∏è 2. √âl√©vation de Privil√®ges (`su` vs `sudo`)

C'est un concept fondamental de s√©curit√© sous Linux.

### `su` (Switch User)

* [cite_start]`su toto` : Vous **devenez** l'utilisateur `toto`, mais vous conservez votre environnement de travail (votre `PATH`, votre `HOME`, etc.)[cite: 508, 510, 519]. [cite_start]C'est ce qui a caus√© l'ex√©cution de votre script `ls` malveillant[cite: 516].
* `su - toto` (ou `su -l toto`) : Simule une **connexion compl√®te** (login) de `toto`. [cite_start]Vous r√©cup√©rez son environnement, son `PATH`, et vous atterrissez dans son `HOME`[cite: 520]. C'est la m√©thode la plus propre pour changer d'utilisateur.

### `sudo` (SuperUser Do)

* [cite_start]**Principe :** Ex√©cute une *seule* commande en tant que `root` (ou un autre utilisateur) sans ouvrir une session compl√®te[cite: 532, 538].
* **Pourquoi `sudo` est mieux que `su root` ?**
    1.  [cite_start]**Tra√ßabilit√© :** *Chaque* commande `sudo` est journalis√©e dans `/var/log/auth.log` avec le nom de l'utilisateur qui l'a lanc√©e[cite: 534, 535, 539]. Si vous √™tes en session `root`, on sait juste que `root` l'a fait, mais pas *qui* √©tait `root`.
    2.  **S√©curit√© :** Vous n'avez pas besoin de partager le mot de passe `root`. [cite_start]Vous pouvez (et devriez) m√™me d√©sactiver le compte `root` (ex: `sudo usermod -p '!' root`)[cite: 540].
    3.  **Permissions granulaires :** Vous pouvez donner des droits limit√©s.

### `/etc/sudoers`

* **Fichier de configuration** qui d√©finit *qui* peut faire *quoi* avec `sudo`.
* [cite_start]**Commande d'√©dition :** TOUJOURS utiliser `visudo`[cite: 544]. Cette commande v√©rifie la syntaxe avant d'enregistrer. Une erreur dans ce fichier peut vous bloquer hors de votre syst√®me.
* **Donner des droits :**
    * [cite_start]**Droits totaux :** Pour donner les droits `sudo` √† `tux`, il faut l'ajouter au groupe `sudo` (ou `admin` selon la distribution)[cite: 525].
    * [cite_start]**Droits partiels :** Vous avez donn√© √† `toto` le droit d'ex√©cuter *uniquement* la commande `cat`[cite: 547]. La ligne dans `sudoers` ressemble √† : `toto ALL=(ALL) /bin/cat`.

---

## üóÇÔ∏è 3. Droits et Attributs de Fichiers

### Droits d'endossement (SetUID / SUID)

* [cite_start]**Commande :** `chmod u+s <fichier>` (le 's' remplace le 'x' pour le propri√©taire)[cite: 559].
* **Principe :** Quand un ex√©cutable a le SUID, il se lance non pas avec les droits de l'utilisateur qui le lance, mais avec les droits du **propri√©taire** du fichier (souvent `root`).
* [cite_start]**Danger :** Vous l'avez appliqu√© √† `/bin/cat`[cite: 559]. [cite_start]N'importe quel utilisateur pouvait alors faire `cat /etc/shadow`[cite: 560], car `cat` s'ex√©cutait en tant que `root` (qui a le droit de lire ce fichier). [cite_start]C'est une **faille de s√©curit√© majeure**[cite: 561].

### Attributs de Fichiers (`chattr`/`lsattr`)

* **Principe :** Des permissions "cach√©es" qui vont au-del√† du `rwx`.
* [cite_start]**Commandes :** `chattr` (pour changer) et `lsattr` (pour lister)[cite: 563].
* **Attribut `a` (Append-only) :**
    * [cite_start]Vous l'avez activ√© : `chattr +a test_attr.txt`[cite: 566].
    * **Effet :**
        * [cite_start]Vous **pouvez** ajouter du contenu √† la fin (ex: `echo "..." >> fichier`)[cite: 570].
        * [cite_start]Vous **ne pouvez PAS** supprimer le fichier[cite: 572].
        * [cite_start]Vous **ne pouvez PAS** l'√©craser (ex: `echo "..." > fichier`)[cite: 571].
        * M√™me `root` ne peut pas supprimer ou modifier le fichier sans d'abord retirer l'attribut (`chattr -a`).

---

## üåç 4. Environnement et Variables

* **Variables Cl√©s :**
    * [cite_start]`PATH` : Liste des r√©pertoires o√π le shell cherche les commandes[cite: 582]. [cite_start]Vous l'avez modifi√© pour inclure `.` (r√©pertoire courant), ce qui est une **mauvaise pratique de s√©curit√©** (cf. votre test avec le script `ls`)[cite: 495, 516].
    * [cite_start]`HOME` : Le r√©pertoire personnel de l'utilisateur[cite: 582].
    * [cite_start]`PS1` (Bonus) : D√©finit l'apparence de votre prompt (invite de commande)[cite: 606].
* **Modification :**
    * [cite_start]**Temporaire :** `export MA_VAR=valeur` (valable pour la session shell active)[cite: 579].
    * [cite_start]**Permanente :** Ajouter la ligne `export ...` dans `~/.profile` (pour les sessions login) ou `~/.bashrc` (pour les shells interactifs)[cite: 580].
* **Historique :**
    * [cite_start]`history` : Affiche les commandes pr√©c√©dentes[cite: 584].
    * [cite_start]`HISTFILE` / `HISTSIZE` : Variables qui contr√¥lent le comportement de l'historique (vous avez modifi√© l'une d'elles pour le d√©sactiver)[cite: 587].
