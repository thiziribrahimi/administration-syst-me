# R√©sum√© Expert TP3 : Disques et Syst√®mes de Fichiers

Ce r√©sum√© couvre les manipulations de disques, le clonage, la copie de syst√®mes et l'interop√©rabilit√© des syst√®mes de fichiers, en se concentrant sur les points essentiels pour votre QCM.

---

## üéØ 1. Analyse Initiale et Sant√© des Disques

Avant toute manipulation, l'analyse de l'existant est cruciale.

* **Commandes d'identification :**
    * [cite_start]`lsblk` : Liste les p√©riph√©riques "bloc" (disques et partitions) et leurs points de montage[cite: 19].
    * [cite_start]`fdisk -l` : Affiche les tables de partitions des disques, y compris le type de partitionnement (MBR ou GPT)[cite: 21, 24].
    * [cite_start]`blkid` : Affiche les identifiants uniques (UUID) et les types de syst√®mes de fichiers (SGF) de chaque partition[cite: 22].

* **UUID (Universally Unique Identifier) :**
    * [cite_start]C'est un identifiant unique pour un **syst√®me de fichiers** (ou une partition)[cite: 23].
    * [cite_start]Le fichier `/etc/fstab` utilise l'UUID pour monter la partition racine (`/`)[cite: 26]. C'est plus fiable que d'utiliser `/dev/sda2`, car ce nom peut changer.
    * **Pi√®ge :** Un SGF (ex: `ext4`) a un UUID. Une partition (ex: `swap`) peut aussi avoir un UUID. [cite_start]C'est pourquoi `blkid` peut afficher plusieurs UUID pour un m√™me disque[cite: 25].

* **Sant√© S.M.A.R.T. :**
    * [cite_start]**Outil :** `smartctl` (du paquet `smartmontools`)[cite: 29].
    * [cite_start]**R√¥le :** Permet de lire les indicateurs de sant√© (S.M.A.R.T.) d'un disque dur[cite: 30].
    * [cite_start]**Indicateur Cl√© :** L'attribut `Reallocated_Sector_Ct` (ID 5) [cite: 41] est critique. S'il est sup√©rieur √† 0, cela signifie que le disque a commenc√© √† marquer des secteurs comme d√©faillants et √† les remplacer. C'est un signe majeur de panne imminente.

---

## üõ†Ô∏è 2. M√©thode 1 : Remplacement par Clonage (`dd`)

[cite_start]**Objectif :** Remplacer un disque syst√®me par un nouveau, plus grand[cite: 73, 76].

**Processus :**
1.  [cite_start]**Mode "Live" :** D√©marrer depuis un Live-CD (ou une cl√© USB)[cite: 52]. [cite_start]On ne peut pas cloner un syst√®me de fichiers *en cours d'utilisation*[cite: 50].
2.  [cite_start]**Clonage :** Utiliser `dd` pour une copie "bloc √† bloc" (octet par octet) du disque initial (`DiskInitial`) vers le nouveau (`DiskFinal`)[cite: 82].
3.  **Probl√®me 1 - Espace Perdu :** `dd` copie la taille *exacte* de la partition d'origine. [cite_start]Le disque final de 30Go n'aura que 25Go d'utilis√©, l'espace suppl√©mentaire est perdu[cite: 93].
4.  **Probl√®me 2 - Conflit d'UUID :** `dd` cr√©e un clone parfait. [cite_start]Les deux disques ont maintenant **exactement les m√™mes UUID**[cite: 124]. [cite_start]Si vous red√©marrez, le syst√®me ne saura pas lequel est le "vrai" disque racine, provoquant un √©chec de d√©marrage[cite: 125].

**Solutions :**
* **Pour l'espace perdu :**
    1.  [cite_start]`fdisk <DiskFinal>` : Supprimer la partition syst√®me[cite: 111].
    2.  [cite_start]`fdisk <DiskFinal>` : Recr√©er la partition avec le **m√™me secteur de d√©but** [cite: 114][cite_start], mais laisser le secteur de fin par d√©faut (la fin du disque)[cite: 115].
    3.  [cite_start]`resize2fs <DiskFinal/PartMax>` : Commande magique qui **agrandit le syst√®me de fichiers (ext4)** pour qu'il remplisse la partition devenue plus grande[cite: 119].
* **Pour le conflit d'UUID :**
    1.  [cite_start]Effacer la table de partition du *vieux disque* (`DiskInitial`) avec `dd` pour le rendre invisible au d√©marrage[cite: 131].
    2.  `reboot`. [cite_start]Le syst√®me d√©marre sur le nouveau disque[cite: 134].

---

## üì¶ 3. M√©thode 2 : Remplacement par Copie de Fichiers (`cp`)

[cite_start]**Objectif :** Migrer le syst√®me vers un autre disque (fonctionne m√™me si le disque final est plus petit, tant que les *donn√©es* rentrent)[cite: 149, 151].

**Processus :**
1.  [cite_start]**Mode "Live" :** Toujours obligatoire[cite: 152].
2.  **Pr√©paration `DiskFinal` :**
    * [cite_start]Cr√©er une structure de partition *identique* √† l'originale (une partition EFI, une partition syst√®me) avec `fdisk`[cite: 168].
    * [cite_start]Formater chaque partition[cite: 175]:
        * [cite_start]Partition EFI : `mkfs.vfat` (FAT32)[cite: 179].
        * [cite_start]Partition Syst√®me : `mkfs.ext4`[cite: 189].
    * [cite_start]**Crucial :** Lors du formatage, utiliser les options (`-i` pour vfat, `-U` pour ext4) pour **forcer les m√™mes UUID/ID** que sur le disque d'origine[cite: 186, 191]. Cela garantit que `/etc/fstab` fonctionnera sans modification.
3.  **Copie des donn√©es :**
    * [cite_start]Monter les deux disques (ex: `/mnt/initial` et `/mnt/final`)[cite: 200, 207].
    * Utiliser `cp` avec les bonnes options. [cite_start]La question [cite: 198] vous guide vers des options comme `-a` (archive) ou `-rP` (r√©cursif + pr√©serve les permissions/propri√©taires/dates).
    * [cite_start]**Optimisation :** Exclure les fichiers inutiles comme `swap.img`[cite: 211, 213].
4.  [cite_start]**Finalisation :** Comme pour la m√©thode 1, effacer l'ancien disque [cite: 221] [cite_start]et red√©marrer[cite: 223].

**Comparaison :**
* `dd` (Clonage) : Rapide, simple, mais copie l'espace vide et n√©cessite un disque de destination de taille >=.
* `cp` (Copie) : Plus lent, plus complexe, mais plus flexible. Permet de changer la taille des partitions et ne copie que les donn√©es utiles.

---

## üìÅ 4. Interop√©rabilit√© (FAT32 / NTFS)

**Objectif :** Comprendre pourquoi le partage de fichiers avec Windows/macOS (via FAT32) pose probl√®me.

* [cite_start]**Le probl√®me `vfat` (FAT32) :** Ce syst√®me de fichiers ne g√®re pas les permissions Linux (propri√©taire, groupe, etc.)[cite: 242].
* [cite_start]**Solution `mount` :** On utilise les options `uid=1000, gid=1000` lors du montage[cite: 236]. Cela *simule* les permissions : tous les fichiers sur la cl√© USB *semblent* appartenir √† votre utilisateur (ID 1000), vous donnant le droit de les lire/√©crire.
* [cite_start]**Le probl√®me de copie :** Vous avez eu des erreurs en copiant des fichiers vers `vfat` ou `ntfs`[cite: 263].
* **Cause :** Ces SGF interdisent certains caract√®res dans les noms de fichiers (ex: `:`, `*`, `?`, `|`) qui sont valides sous Linux (ext4).
* [cite_start]**Solution de transport :** Pour d√©placer des fichiers "non compatibles" sur une cl√© USB, il faut les mettre dans une "bo√Æte" : cr√©ez une **archive** (ex: `tar.gz`)[cite: 265, 248].
